{"version":3,"sources":["common/connect.test.tsx"],"names":[],"mappings":"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","file":"common/connect.test.js","sourcesContent":["/* tslint:disable:no-unused-variable */\r\nimport * as React from 'react';\r\n/* tslint:enable:no-unused-variable */\r\nimport * as ReactDOM from 'react-dom';\r\n\r\nimport * as ReactTestUtils from 'react-addons-test-utils';\r\nimport { connect } from './connect';\r\nimport { BaseStore } from './BaseStore';\r\nimport { StoreHost } from './StoreHost';\r\nimport { StoreSet } from './StoreSet';\r\nimport { storeKey } from './storeKey';\r\nimport { ISubscribable } from './ISubscribable';\r\n\r\nlet { expect } = chai;\r\n\r\ninterface ITestComponentProps extends React.HTMLProps<HTMLDivElement> { }\r\n\r\n// Dumb component.\r\nconst TestComponent = (props: ITestComponentProps) => (\r\n  <div { ...props } />\r\n);\r\n\r\n// Dumb store.\r\ninterface IHelloStore extends ISubscribable {\r\n  message: string;\r\n\r\n  say(message: string): void;\r\n}\r\n\r\ninterface IAddStore extends ISubscribable {\r\n  result: number;\r\n\r\n  add(num1: number, num2: number): void;\r\n}\r\n\r\nclass AddStore extends BaseStore implements ISubscribable {\r\n\r\n}\r\n\r\nclass HelloStore extends BaseStore implements IHelloStore {\r\n  public message: string = '';\r\n\r\n  public say(message) {\r\n    this.message = message;\r\n    this.emitChange();\r\n  }\r\n}\r\n\r\ndescribe('connect', () => {\r\n  it('can observe store changes', (done) => {\r\n    let hello1 = storeKey<IHelloStore>('hello1');\r\n    let hello2 = storeKey<IHelloStore>('hello2');\r\n    let localStores = new StoreSet()\r\n      .add(hello1, new HelloStore())\r\n      .add(hello2, new HelloStore());\r\n\r\n    let Connected = connect<ITestComponentProps, {}>(\r\n      TestComponent,\r\n      [hello1, hello2],\r\n      (props: ITestComponentProps, hello1Store: IHelloStore, hello2Store: IHelloStore) => ({\r\n        children: hello1Store.message + hello2Store.message\r\n      })\r\n    );\r\n    let root = ReactTestUtils.renderIntoDocument(\r\n      <div>\r\n        <StoreHost stores={ localStores }>\r\n          <Connected />\r\n        </StoreHost>\r\n      </div>\r\n    );\r\n    let rootElement = ReactDOM.findDOMNode(root as React.ReactInstance);\r\n\r\n    expect(rootElement.textContent).equals('');\r\n\r\n    localStores.getStore(hello1).say('hello');\r\n    setTimeout(() => {\r\n      try {\r\n        expect(rootElement.textContent).equals('hello');\r\n        localStores.getStore(hello2).say(' world');\r\n\r\n        setTimeout(() => {\r\n          try {\r\n            expect(rootElement.textContent).equals('hello world');\r\n            done();\r\n          } catch (e) { done(e); }\r\n        }, 10);\r\n\r\n      } catch (e) { done(e); }\r\n    }, 10);\r\n\r\n  });\r\n\r\n  it('can throw when requiring a store in an environment without any stores hosted', () => {\r\n    let hello = storeKey<IHelloStore>('hello');\r\n    let Connected = connect(\r\n      TestComponent,\r\n      [hello],\r\n      () => { /* empty */ }\r\n    );\r\n    let threwException = false;\r\n\r\n    try {\r\n      ReactTestUtils.renderIntoDocument(\r\n        <div>\r\n          <Connected />\r\n        </div>\r\n      );\r\n    } catch (e) { threwException = true; }\r\n\r\n    expect(threwException).to.be.true;\r\n  });\r\n\r\n  it('can throw in an environment that does not contain the required store', () => {\r\n    let hello = storeKey<IHelloStore>('hello');\r\n    let Connected = connect(\r\n      TestComponent,\r\n      [hello],\r\n      () => { /* empty */ }\r\n    );\r\n    let threwException = false;\r\n\r\n    try {\r\n      ReactTestUtils.renderIntoDocument(\r\n        <StoreHost stores={ new StoreSet() }>\r\n          <div>\r\n            <Connected />\r\n          </div>\r\n        </StoreHost>\r\n      );\r\n    } catch (e) { threwException = true; }\r\n\r\n    expect(threwException).to.be.true;\r\n  });\r\n\r\n  it('renders a connected component 1 time when multiple stores fire changes', (done) => {\r\n    let resolves = 0;\r\n    let renders = 0;\r\n\r\n    const Dumb = () => {\r\n      renders++;\r\n      return <div>hi</div>;\r\n    };\r\n\r\n    let hello1 = storeKey<IHelloStore>('hello1');\r\n    let hello2 = storeKey<IHelloStore>('hello2');\r\n    let localStores = new StoreSet()\r\n      .add(hello1, new HelloStore())\r\n      .add(hello2, new HelloStore());\r\n    let Connected = connect(\r\n      Dumb,\r\n      [hello1, hello2],\r\n      () => {\r\n        resolves++;\r\n        return {};\r\n      });\r\n\r\n    ReactTestUtils.renderIntoDocument(\r\n      <div>\r\n        <StoreHost stores={ localStores }>\r\n          <Connected />\r\n        </StoreHost>\r\n      </div>\r\n    );\r\n\r\n    expect(resolves).to.equal(1, 'resolve was not 1');\r\n    expect(renders).to.equal(1, 'render was not 1');\r\n\r\n    // Cause 2 store changes. This should setImmediate and cause 1 resolve.\r\n    localStores.getStore(hello1).say('hello');\r\n    localStores.getStore(hello2).say(' world');\r\n\r\n    setTimeout(() => {\r\n      try {\r\n        expect(resolves).to.equal(2, 'resolve was not 2');\r\n        expect(renders).to.equal(1, 'render was not 1');\r\n        done();\r\n      } catch (e) { done(e); }\r\n    }, 10);\r\n  });\r\n});\r\n"],"sourceRoot":"..\\..\\src"}